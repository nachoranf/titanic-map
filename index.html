<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Recorrido del Titanic</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
    }
    #map {
      position: fixed;
      top: 0;
      left: 0;
      height: 100vh;
      width: 100%;
      z-index: 0;
      pointer-events: none;
    }
    .spacer {
      height: 100vh;
    }
  </style>
</head>
<body>

<div id="map"></div>

<!-- Scroll triggers (invisibles) -->
<div class="spacer" data-step="1"></div>
<div class="spacer" data-step="2"></div>
<div class="spacer" data-step="3"></div>
<div class="spacer" data-step="4"></div>
<div class="spacer" data-step="5"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/scrollama"></script>
<script>
  // Coordenadas del viaje del Titanic
  const coords = [
    [50.904, -1.404],     // Southampton
    [49.637, -1.617],     // Cherburgo
    [51.849, -8.294],     // Queenstown (Cobh)
    [42.0, -40.0],        // Océano Atlántico
    [41.7325, -49.9469],  // Hundimiento
  ];

  const labels = [
    "Southampton",
    "Cherburgo",
    "Queenstown",
    "Océano Atlántico",
    "Hundimiento"
  ];

  const map = L.map('map', {
    zoomControl: false,
    dragging: false,
    scrollWheelZoom: false,
    doubleClickZoom: false,
    boxZoom: false,
    keyboard: false,
    tap: false,
  }).setView([46.5, -30], 4);

  // Mapa base claro
  L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  // Línea que se va construyendo
  const polyline = L.polyline([], {
    color: 'navy',
    weight: 4
  }).addTo(map);

  // Lista para guardar los marcadores que se van revelando
  const markers = [];

  // Scrollama setup
  const scroller = scrollama();

  scroller
    .setup({
      step: ".spacer",
      offset: 0.5,
      progress: false,
    })
    .onStepEnter(response => {
      const index = parseInt(response.element.dataset.step);
      const newSegment = coords.slice(0, index);
      polyline.setLatLngs(newSegment);

      // BONUS: Agregar marcador si aún no fue agregado
      if (!markers[index - 1]) {
        const marker = L.marker(coords[index - 1]).bindTooltip(labels[index - 1], { permanent: true, direction: 'right' }).addTo(map);
        markers[index - 1] = marker;
      }
    });
</script>

</body>
</html>
