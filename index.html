<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Viaje del Titanic - Scroll Reveal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow-x: hidden;
      font-family: sans-serif;
    }
    #map {
      position: fixed;
      top: 0;
      left: 0;
      height: 100vh;
      width: 100%;
      z-index: 0;
      pointer-events: none;
    }

    /* Invisible scroll triggers */
    .trigger-container {
      height: 500vh; /* 5 puntos = 5 pasos de scroll */
      position: relative;
    }
    .step {
      position: absolute;
      top: 0;
      height: 100vh;
      width: 100%;
    }
    .step:nth-child(1) { top: 0vh; }
    .step:nth-child(2) { top: 100vh; }
    .step:nth-child(3) { top: 200vh; }
    .step:nth-child(4) { top: 300vh; }
    .step:nth-child(5) { top: 400vh; }
  </style>
</head>
<body>

<div id="map"></div>

<div class="trigger-container">
  <div class="step" data-step="1"></div>
  <div class="step" data-step="2"></div>
  <div class="step" data-step="3"></div>
  <div class="step" data-step="4"></div>
  <div class="step" data-step="5"></div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/scrollama"></script>
<script>
  const coords = [
    [50.904, -1.404],     // Southampton
    [49.637, -1.617],     // Cherburgo
    [51.849, -8.294],     // Queenstown (Cobh)
    [42.0, -40.0],        // Océano Atlántico
    [41.7325, -49.9469],  // Hundimiento
  ];

  const labels = [
    "Southampton",
    "Cherburgo",
    "Queenstown",
    "Atlántico",
    "Hundimiento"
  ];

  const map = L.map('map', {
    zoomControl: false,
    dragging: false,
    scrollWheelZoom: false,
    doubleClickZoom: false,
    boxZoom: false,
    keyboard: false,
    tap: false,
  }).setView([46.5, -30], 4);

  L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  const polyline = L.polyline([], {
    color: 'navy',
    weight: 4
  }).addTo(map);

  const markers = [];

  const scroller = scrollama();
  scroller
    .setup({
      step: ".step",
      offset: 0.5,
      progress: false,
    })
    .onStepEnter(response => {
      const index = parseInt(response.element.dataset.step);
      const newSegment = coords.slice(0, index);
      polyline.setLatLngs(newSegment);

      // BONUS: mostrar marcador solo si aún no está
      if (!markers[index - 1]) {
        const marker = L.marker(coords[index - 1])
          .bindTooltip(labels[index - 1], { permanent: true, direction: 'right' })
          .addTo(map);
        markers[index - 1] = marker;
      }
    });
</script>

</body>
</html>
