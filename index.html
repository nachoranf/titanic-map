<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Viaje del Titanic con Ruta Completa</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow-x: hidden;
      font-family: sans-serif;
    }
    #map {
      position: fixed;
      top: 0;
      left: 0;
      height: 100vh;
      width: 100%;
      z-index: 0;
      pointer-events: none;
    }

    .trigger-container {
      height: 7500vh;
      position: relative;
    }
    .step {
      position: absolute;
      top: 0;
      height: 100vh;
      width: 100%;
    }
    .step:nth-child(n) {
      top: calc((100vh * (var(--i))));
    }
  </style>
</head>
<body>

<div id="map"></div>

<div class="trigger-container">
  <!-- 75 pasos invisibles -->
  <script>
    const triggerContainer = document.currentScript.parentElement;
    const totalSteps = 75;
    for (let i = 1; i <= totalSteps; i++) {
      const div = document.createElement('div');
      div.className = 'step';
      div.dataset.step = i;
      div.style.setProperty('--i', i - 1);
      triggerContainer.appendChild(div);
    }
  </script>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/scrollama"></script>
<script>
  // 75 puntos del recorrido total (incluyendo Nueva York)
  const coords = [
    [50.904000, -1.404000], [50.904000, -1.404000], [51.204232, -1.858152],
    [50.674016, -1.694976], [49.866984, -1.326024], [49.071801, -1.182626],
    [49.094480, -1.252224], [49.590221, -1.637958], [50.371444, -2.258987],
    [51.255572, -3.034467], [52.060026, -3.883556], [52.602229, -4.725411],
    [52.699601, -5.479190], [52.169564, -6.064051], [50.829541, -6.399150],
    [48.496951, -6.403646], [45.989217, -6.096695], [44.103761, -5.497456],
    [43.648004, -4.625086], [44.429368, -3.498741], [46.255275, -2.137580],
    [48.933146, -0.560758], [52.270404, 1.132586], [56.074470, 3.012314],
    [60.152765, 5.059291], [64.312711, 7.244380], [68.361730, 9.538447],
    [72.107242, 11.912356], [75.356669, 14.336972], [77.917433, 16.783160],
    [79.596954, 19.221783], [80.202654, 21.623707], [79.541955, 23.959796],
    [77.422277, 26.200916], [73.651041, 28.317930], [68.035669, 30.281705],
    [60.383580, 32.063103], [50.502197, 33.632990], [41.7325, -49.9469],
    [41.5047, -52.5952], [41.2769, -55.2435], [41.0491, -57.8918],
    [40.8213, -60.5401], [40.5935, -63.1884], [40.3657, -65.8367],
    [40.1379, -68.4850], [39.9101, -71.1333], [39.6823, -73.7816],
    [40.7128, -74.0060]
  ];

  const map = L.map('map', {
    zoomControl: false,
    dragging: false,
    scrollWheelZoom: false,
    doubleClickZoom: false,
    boxZoom: false,
    keyboard: false,
    tap: false,
  }).setView([46.5, -30], 4);

  L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  const solidLine = L.polyline([], {
    color: 'red',
    weight: 4
  }).addTo(map);

  const dashedLine = L.polyline([], {
    color: 'red',
    weight: 3,
    dashArray: '6, 8'
  }).addTo(map);

  // marcadores fijos
  L.marker([50.904, -1.404]).addTo(map)
    .bindTooltip("Southampton", { permanent: true, direction: 'right' });

  L.marker([40.7128, -74.0060]).addTo(map)
    .bindTooltip("Nueva York", { permanent: true, direction: 'left' });

  let crossAdded = false;
  const hundimientoCoord = [41.7325, -49.9469];
  const hundimientoIndex = coords.findIndex(([lat, lon]) =>
    lat === hundimientoCoord[0] && lon === hundimientoCoord[1]
  );

  const scroller = scrollama();
  scroller
    .setup({
      step: ".step",
      offset: 0.5,
      progress: false,
    })
    .onStepEnter(response => {
      const step = parseInt(response.element.dataset.step);
      const index = Math.floor(step * coords.length / 75);

      // segmento hasta hundimiento (sólido)
      const solidSegment = coords.slice(0, Math.min(index + 1, hundimientoIndex + 1));
      solidLine.setLatLngs(solidSegment);

      // segmento después del hundimiento (punteado)
      if (index > hundimientoIndex) {
        const dashedSegment = coords.slice(hundimientoIndex, index + 1);
        dashedLine.setLatLngs(dashedSegment);
      }

      if (index >= hundimientoIndex && !crossAdded) {
        L.marker(hundimientoCoord, {
          icon: L.divIcon({
            html: '❌',
            className: '',
            iconSize: [24, 24]
          })
        }).addTo(map).bindTooltip("Hundimiento", { permanent: true, direction: 'left' });
        crossAdded = true;
      }
    });
</script>

</body>
</html>
