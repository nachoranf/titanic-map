<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Viaje del Titanic - Curvas y Scroll Suave</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow-x: hidden;
      font-family: sans-serif;
    }
    #map {
      position: fixed;
      top: 0;
      left: 0;
      height: 100vh;
      width: 100%;
      z-index: 0;
      pointer-events: none;
    }

    .trigger-container {
      height: 10000vh; /* 100 pasos x 100vh */
      position: relative;
    }
    .step {
      position: absolute;
      top: 0;
      height: 100vh;
      width: 100%;
    }
    .step:nth-child(n) {
      top: calc((100vh * (var(--i))));
    }
  </style>
</head>
<body>

<div id="map"></div>

<div class="trigger-container">
  <!-- Scroll Steps generados por JS -->
  <script>
    const triggerContainer = document.currentScript.parentElement;
    const totalSteps = 100;
    for (let i = 1; i <= totalSteps; i++) {
      const div = document.createElement('div');
      div.className = 'step';
      div.dataset.step = i;
      div.style.setProperty('--i', i - 1);
      triggerContainer.appendChild(div);
    }
  </script>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/scrollama"></script>
<script>
  // Puntos suavizados (curva Bézier)
  const coords = [
    [50.904000, -1.404000],
    [51.094598, -1.606466],
    [51.199436, -1.745180],
    [51.228602, -1.827643],
    [51.192187, -1.861354],
    [51.100279, -1.853812],
    [50.963970, -1.812515],
    [50.793351, -1.744962],
    [50.598510, -1.658652],
    [50.389539, -1.561084],
    [50.176527, -1.459757],
    [49.969564, -1.362170],
    [49.778741, -1.275822],
    [49.614147, -1.208213],
    [49.485872, -1.166842],
    [49.404007, -1.159208],
    [49.378641, -1.192811],
    [49.419864, -1.275149],
    [49.537766, -1.413723],
    [49.742437, -1.616030],
    [49.911605, -1.826051],
    [50.045222, -2.045896],
    [50.143236, -2.277672],
    [50.205597, -2.523489],
    [50.232254, -2.785454],
    [50.223158, -3.065676],
    [50.178257, -3.366263],
    [50.097502, -3.689325],
    [49.980842, -4.036969],
    [49.828226, -4.411304],
    [49.639604, -4.814438],
    [49.414926, -5.248480],
    [49.154141, -5.715538],
    [48.857199, -6.217722],
    [48.524048, -6.757140],
    [48.154639, -7.335900],
    [47.748920, -7.956113],
    [47.306842, -8.619885],
    [46.828353, -9.329327],
    [46.313403, -10.086546],
    [45.761942, -10.893651],
    [45.173919, -11.752751],
    [44.549284, -12.665954],
    [43.887986, -13.635370],
    [43.189975, -14.663106],
    [42.455199, -15.751272],
    [41.683610, -16.901975],
    [40.875155, -18.117324],
    [40.029784, -19.399428],
    [39.147446, -20.750395],
    [38.228091, -22.172334],
    [37.271668, -23.667353],
    [36.278127, -25.237560],
    [35.247418, -26.885065],
    [34.179490, -28.611976],
    [33.074292, -30.420401],
    [31.931775, -32.312450],
    [30.751888, -34.290229],
    [29.534581, -36.355849],
    [28.279803, -38.511417],
    [26.987505, -40.759042],
    [25.657636, -43.100833],
    [24.290146, -45.538898],
    [22.885085, -48.075346],
    [21.442403, -50.712284],
    [19.962050, -53.451822],
    [18.443975, -56.296068],
    [16.888128, -59.247130],
    [15.294459, -62.307116],
    [13.662917, -65.478136],
    [11.993452, -68.762298],
    [10.286013, -72.161711],
    [8.540551, -75.678483],
    [6.757015, -79.314722],
    [4.935355, -83.072537],
    [3.075520, -86.954037],
    [1.177460, -90.961331],
    [-0.758875, -95.096526],
    [-2.733535, -99.361732],
    [-4.746571, -103.759058],
    [-6.798035, -108.290612],
    [-8.887978, -112.958503],
    [-11.016450, -117.764838],
    [-13.183502, -122.711728],
    [-15.389186, -127.801279],
    [-17.633553, -133.035602],
    [-19.916653, -138.416804],
    [-22.238538, -143.946993],
    [-24.599259, -149.628278],
    [-26.998866, -155.462768],
    [-29.437411, -161.452570],
    [-31.914946, -167.599794],
    [-34.431521, -173.906547],
    [-36.987188, -180.374938],
    [41.7325, -49.9469] // hundimiento
  ];

  const map = L.map('map', {
    zoomControl: false,
    dragging: false,
    scrollWheelZoom: false,
    doubleClickZoom: false,
    boxZoom: false,
    keyboard: false,
    tap: false,
  }).setView([46.5, -30], 4);

  L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  const polyline = L.polyline([], {
    color: 'red',
    weight: 4
  }).addTo(map);

  let crossAdded = false;

  const scroller = scrollama();
  scroller
    .setup({
      step: ".step",
      offset: 0.5,
      progress: false,
    })
    .onStepEnter(response => {
      const step = parseInt(response.element.dataset.step);
      const index = Math.floor(step * coords.length / 100);
      polyline.setLatLngs(coords.slice(0, index + 1));

      if (step === 100 && !crossAdded) {
        L.marker([41.7325, -49.9469], {
          icon: L.divIcon({
            html: '❌',
            className: '',
            iconSize: [24, 24]
          })
        }).addTo(map).bindTooltip("Hundimiento", { permanent: true, direction: 'left' });
        crossAdded = true;
      }
    });
</script>

</body>
</html>
